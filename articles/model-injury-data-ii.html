<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="injurytools">
<title>Model Sports Injuries as Events • injurytools</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Model Sports Injuries as Events">
<meta property="og:description" content="injurytools">
<meta property="og:image" content="https://lzumeta.github.io/injurytools/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">injurytools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/prepare-injury-data.html">Prepare data</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Describe data</h6>
    <a class="dropdown-item" href="../articles/estimate-epi-measures.html">Estimate summary statistics</a>
    <a class="dropdown-item" href="../articles/visualize-injury-data.html">Visualize data</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Model data</h6>
    <a class="dropdown-item" href="../articles/model-injury-data-i.html">Injuries as count data</a>
    <a class="dropdown-item" href="../articles/model-injury-data-ii.html">Injuries as time-to-event data</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/lzumeta/injurytools">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Model Sports Injuries as Events</h1>
            
            <h4 data-toc-skip class="date">2023-09-25</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/lzumeta/injurytools/blob/HEAD/vignettes/model-injury-data-ii.Rmd" class="external-link"><code>vignettes/model-injury-data-ii.Rmd</code></a></small>
      <div class="d-none name"><code>model-injury-data-ii.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lzumeta/injurytools" class="external-link">injurytools</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/survminer/index.html" class="external-link">survminer</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">coxme</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span></code></pre></div>
<p><strong>Example data</strong>: we continue exploring the cohort of
Liverpool Football Club male’s first team players over two consecutive
seasons, 2017-2018 and 2018-2019, scrapped from <a href="https://www.transfermarkt.com/" class="external-link uri">https://www.transfermarkt.com/</a> website<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;These data sets are provided for illustrative purposes.
We warn that they might not be accurate, there might be a mismatch and
non-completeness with what actually occurred.&lt;/p&gt;"><sup>1</sup></a>.</p>
<p>This document presents basic examples for modeling the association
between covariates and injuries using Survival Analysis, or
Time-to-Event Analysis, models. Depending on the aim of the analyses, it
illustrates possible survival models, as well as how to prepare the
data, what model assumptions are made on the data, how to fit them and
how to display the estimated results.</p>
<div class="section level2">
<h2 id="brief-background">Brief background<a class="anchor" aria-label="anchor" href="#brief-background"></a>
</h2>
<p>This approach is possible when players are followed over the course
of time, since we consider injuries as time-to-event outcome
variables.</p>
<p>Broadly speaking, we define the outcome variable, <span class="math inline">\(T\)</span>, as “the time until the occurrence of
an injury (event)”. Then, data analysis is regularly performed before or
without knowing all injury event times (e.g. a study might be finished
with players not experiencing the injury or players may drop out of the
study), which leads to incomplete observations known as censoring
(i.e. we observe <span class="math inline">\(Y = \min(T, C)\)</span>,
where <span class="math inline">\(C\)</span> is the censorship
variable).</p>
<p>In the following two sections, we first show the application of the
well-known Kaplan-Meier method and Cox Proportional Hazards (Cox PH)
model on sports injury data and after that, we describe two possible
survival modelling strategies that take into account the recurrence of
injuries (repeated observations per player).</p>
</div>
<div class="section level2">
<h2 id="methods-for-time-to-first-injury">Methods for time to first injury<a class="anchor" aria-label="anchor" href="#methods-for-time-to-first-injury"></a>
</h2>
<p>We prepare the data so that for each separate season we have an
<code>injd</code> object with each observation (row) corresponding to
<strong>time to first injury</strong> (or end of the season, or a
transfer to another team, i.e. censored observation).</p>
<p>The final data frames are called <code>injd1718_sub</code> and
<code>injd1819_sub</code>.</p>
<details><summary>
See the code to prepare the data
</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## 17/18</span></span>
<span><span class="va">df_exposures1718</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_data.html">prepare_exp</a></span><span class="op">(</span>df_exposures0 <span class="op">=</span> </span>
<span>                                  <span class="va">raw_df_exposures</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">season</span> <span class="op">==</span> <span class="st">"17/18"</span><span class="op">)</span>,</span>
<span>                                player        <span class="op">=</span> <span class="st">"player_name"</span>,</span>
<span>                                date          <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>                                time_expo     <span class="op">=</span> <span class="st">"minutes_played"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>seasonb <span class="op">=</span> <span class="fu"><a href="../reference/date2season.html">date2season</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df_injuries1718</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_data.html">prepare_inj</a></span><span class="op">(</span>df_injuries0   <span class="op">=</span></span>
<span>                                 <span class="va">raw_df_injuries</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">season</span> <span class="op">==</span> <span class="st">"17/18"</span><span class="op">)</span>,</span>
<span>                               player         <span class="op">=</span> <span class="st">"player_name"</span>,</span>
<span>                               date_injured   <span class="op">=</span> <span class="st">"from"</span>,</span>
<span>                               date_recovered <span class="op">=</span> <span class="st">"until"</span><span class="op">)</span></span>
<span><span class="va">injd1718</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_data.html">prepare_all</a></span><span class="op">(</span>data_exposures <span class="op">=</span> <span class="va">df_exposures1718</span>,</span>
<span>                        data_injuries  <span class="op">=</span> <span class="va">df_injuries1718</span>,</span>
<span>                        exp_unit <span class="op">=</span> <span class="st">"matches_minutes"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">injd1718</span> <span class="op">&lt;-</span> <span class="va">injd1718</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>seasonb <span class="op">=</span> <span class="fu"><a href="../reference/date2season.html">date2season</a></span><span class="op">(</span><span class="va">tstart</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co">## join to have info such as position, age, citizenship etc.</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">df_exposures1718</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"player"</span> <span class="op">=</span> <span class="st">"player"</span>, </span>
<span>                                     <span class="st">"seasonb"</span> <span class="op">=</span> <span class="st">"seasonb"</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="co">## create injd1718_sub:</span></span>
<span><span class="co">##  - time to first injury</span></span>
<span><span class="co">##  - equivalent tstart and tstop in calendar days</span></span>
<span><span class="va">injd1718_sub</span> <span class="op">&lt;-</span> <span class="va">injd1718</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>tstop_day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">tstop</span>, <span class="va">tstart</span>, units <span class="op">=</span> <span class="st">"days"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">player</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co">## important</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>tstop_day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">tstop_day</span><span class="op">)</span>,</span>
<span>         tstart_day <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">tstop_day</span>, default <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">player</span><span class="op">:</span><span class="va">tstop_minPlay</span>, <span class="va">tstart_day</span>, <span class="va">tstop_day</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">enum</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="co">## time to first injury</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## 18/19</span></span>
<span><span class="va">df_exposures1819</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_data.html">prepare_exp</a></span><span class="op">(</span>df_exposures0 <span class="op">=</span> </span>
<span>                                  <span class="va">raw_df_exposures</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">season</span> <span class="op">==</span> <span class="st">"18/19"</span><span class="op">)</span>,</span>
<span>                                player        <span class="op">=</span> <span class="st">"player_name"</span>,</span>
<span>                                date          <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>                                time_expo     <span class="op">=</span> <span class="st">"minutes_played"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>seasonb <span class="op">=</span> <span class="fu"><a href="../reference/date2season.html">date2season</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df_injuries1819</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_data.html">prepare_inj</a></span><span class="op">(</span>df_injuries0   <span class="op">=</span> </span>
<span>                                 <span class="va">raw_df_injuries</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">season</span> <span class="op">==</span> <span class="st">"18/19"</span><span class="op">)</span>,</span>
<span>                               player         <span class="op">=</span> <span class="st">"player_name"</span>,</span>
<span>                               date_injured   <span class="op">=</span> <span class="st">"from"</span>,</span>
<span>                               date_recovered <span class="op">=</span> <span class="st">"until"</span><span class="op">)</span></span>
<span><span class="va">injd1819</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_data.html">prepare_all</a></span><span class="op">(</span>data_exposures <span class="op">=</span> <span class="va">df_exposures1819</span>,</span>
<span>                        data_injuries  <span class="op">=</span> <span class="va">df_injuries1819</span>,</span>
<span>                        exp_unit <span class="op">=</span> <span class="st">"matches_minutes"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">injd1819</span> <span class="op">&lt;-</span> <span class="va">injd1819</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>seasonb <span class="op">=</span> <span class="fu"><a href="../reference/date2season.html">date2season</a></span><span class="op">(</span><span class="va">tstart</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co">## join to have info such as position, age, citizenship etc.</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">df_exposures1819</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"player"</span> <span class="op">=</span> <span class="st">"player"</span>, </span>
<span>                                     <span class="st">"seasonb"</span> <span class="op">=</span> <span class="st">"seasonb"</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="co">## create injd1819_sub:</span></span>
<span><span class="co">##  - time to first injury</span></span>
<span><span class="co">##  - equivalent tstart and tstop in calendar days</span></span>
<span><span class="va">injd1819_sub</span> <span class="op">&lt;-</span> <span class="va">injd1819</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>tstop_day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">tstop</span>, <span class="va">tstart</span>, units <span class="op">=</span> <span class="st">"days"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">player</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co">## important</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>tstop_day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">tstop_day</span><span class="op">)</span>,</span>
<span>         tstart_day <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">tstop_day</span>, default <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">player</span><span class="op">:</span><span class="va">tstop_minPlay</span>, <span class="va">tstart_day</span>, <span class="va">tstop_day</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">enum</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="co">## time to first injury</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## CHECK</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">injd1718_sub</span><span class="op">$</span><span class="va">tstop_day</span> <span class="op">==</span> <span class="va">injd1718_sub</span><span class="op">$</span><span class="va">tstart_day</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">injd1718_sub</span><span class="op">$</span><span class="va">tstop_minPlay</span> <span class="op">==</span> <span class="va">injd1718_sub</span><span class="op">$</span><span class="va">tstart_minPlay</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">injd1819_sub</span><span class="op">$</span><span class="va">tstop_day</span> <span class="op">==</span> <span class="va">injd1819_sub</span><span class="op">$</span><span class="va">tstart_day</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">injd1819_sub</span><span class="op">$</span><span class="va">tstop_minPlay</span> <span class="op">==</span> <span class="va">injd1819_sub</span><span class="op">$</span><span class="va">tstart_minPlay</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
</details><div class="section level3">
<h3 id="kaplan-meier-curve">Kaplan-Meier curve<a class="anchor" aria-label="anchor" href="#kaplan-meier-curve"></a>
</h3>
<p>For this section we join both data sets by row:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">injd_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="st">"17-18"</span> <span class="op">=</span> <span class="va">injd1718_sub</span>,</span>
<span>                      <span class="st">"18-19"</span> <span class="op">=</span> <span class="va">injd1819_sub</span>,</span>
<span>                      .id <span class="op">=</span> <span class="st">"season"</span><span class="op">)</span></span></code></pre></div>
<p>Now, we estimate the survival probabilities, <span class="math inline">\(\hat{S}_{\text{KM}}(t)\)</span>, in each season,
as follows:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html" class="external-link">survfit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">tstart_day</span>, <span class="va">tstop_day</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">seasonb</span>,</span>
<span>               data <span class="op">=</span> <span class="va">injd_sub</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span></span>
<span><span class="co">#&gt; Call: survfit(formula = Surv(tstart_day, tstop_day, status) ~ seasonb, </span></span>
<span><span class="co">#&gt;     data = injd_sub)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                    n events median 0.95LCL 0.95UCL</span></span>
<span><span class="co">#&gt; seasonb=2017/2018 23     16    265     152      NA</span></span>
<span><span class="co">#&gt; seasonb=2018/2019 19     17    106      84     165</span></span></code></pre></div>
<p>The number of first-time injuries in both seasons is similar (16
vs. 17), but the median survival probability is lower in the 2018/2019
season, i.e. in 2018/2019 the estimated probability of being injury free
by 106-th day or before is 50% (equivalently, the estimated probability
of surviving 106 days (three months and a half) is 50%), whereas in
2017/2019 the probability of surviving the same time is 69.57%.</p>
<p>Next, we plot the Kaplan-Meier (KM) curves for each season based on
the above results via the <a href="https://rpkgs.datanovia.com/survminer/reference/ggsurvplot.html" class="external-link"><code>survminer::ggsurvplot</code></a>
function:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/survminer/man/ggsurvplot.html" class="external-link">ggsurvplot</a></span><span class="op">(</span><span class="va">fit</span>, data <span class="op">=</span> <span class="va">injd_sub</span>,</span>
<span>           palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#E7B800"</span>, <span class="st">"#2E9FDF"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co">## colors for the curves</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Time (calendar days)"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Survival probability  ("</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">hat</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span><span class="op">[</span><span class="va">KM</span><span class="op">]</span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">*</span><span class="st">")"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Kaplan-Meier curves"</span>, </span>
<span>          subtitle <span class="op">=</span> <span class="st">"in each season (time to first injury)"</span><span class="op">)</span> </span></code></pre></div>
<p><img src="model-injury-data-ii_files/figure-html/unnamed-chunk-8-1.png" width="960"></p>
<p>Let’s add more information to the previous plot, such as the
estimated median survival probability.</p>
<details><summary>
Code for adding more info to the previous plot
</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## since tstop_day == (tstop_day - tstart_day)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">injd_sub</span><span class="op">$</span><span class="va">tstop_day</span> <span class="op">==</span> <span class="op">(</span><span class="va">injd_sub</span><span class="op">$</span><span class="va">tstop_day</span> <span class="op">-</span> <span class="va">injd_sub</span><span class="op">$</span><span class="va">tstart_day</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># [1] TRUE</span></span>
<span></span>
<span><span class="co">## equivalent fits:</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html" class="external-link">survfit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">tstart_day</span>, <span class="va">tstop_day</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">seasonb</span>, data <span class="op">=</span> <span class="va">injd_sub</span><span class="op">)</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html" class="external-link">survfit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">tstop_day</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">seasonb</span>, data <span class="op">=</span> <span class="va">injd_sub</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ggsurv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survminer/man/ggsurvplot.html" class="external-link">ggsurvplot</a></span><span class="op">(</span><span class="va">fit</span>, data <span class="op">=</span> <span class="va">injd_sub</span>,</span>
<span>           palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#E7B800"</span>, <span class="st">"#2E9FDF"</span><span class="op">)</span>,</span>
<span>           surv.median.line <span class="op">=</span> <span class="st">"hv"</span>,</span>
<span>           ggtheme <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>           break.time.by <span class="op">=</span> <span class="fl">60</span>,</span>
<span>           xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">370</span><span class="op">)</span>,</span>
<span>           legend.labs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Season 17/18"</span>, <span class="st">"Season 18/19"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Time (calendar days)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Survival probability  ("</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">hat</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span><span class="op">[</span><span class="va">KM</span><span class="op">]</span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">*</span><span class="st">")"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Kaplan-Meier curves"</span>, </span>
<span>          subtitle <span class="op">=</span> <span class="st">"in each season (time to first injury)"</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># add median survival estimates</span></span>
<span><span class="va">ggsurv</span><span class="op">$</span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="va">ggsurv</span><span class="op">$</span><span class="va">plot</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, </span>
<span>           x <span class="op">=</span> <span class="fl">70</span>, y <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>           label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">hat</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span><span class="op">[</span><span class="fl">18</span><span class="op">/</span><span class="fl">19</span><span class="op">]</span><span class="op">*</span><span class="st">"(106)=0.5"</span><span class="op">)</span>,</span>
<span>           col <span class="op">=</span> <span class="st">"#2E9FDF"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, </span>
<span>           x <span class="op">=</span> <span class="fl">230</span>, y <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>           label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">hat</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span><span class="op">[</span><span class="fl">17</span><span class="op">/</span><span class="fl">18</span><span class="op">]</span><span class="op">*</span><span class="st">"(265)=0.5"</span><span class="op">)</span>,</span>
<span>           col <span class="op">=</span> <span class="st">"#E7B800"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ggsurv</span><span class="op">$</span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="va">ggsurv</span><span class="op">$</span><span class="va">plot</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">rel</a></span><span class="op">(</span><span class="fl">1.5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">rel</a></span><span class="op">(</span><span class="fl">1.5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">rel</a></span><span class="op">(</span><span class="fl">1.3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">rel</a></span><span class="op">(</span><span class="fl">1.3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">rel</a></span><span class="op">(</span><span class="fl">1.2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ggsurv</span></span></code></pre></div>
</details><p><img src="model-injury-data-ii_files/figure-html/unnamed-chunk-11-1.png" width="960"></p>
<p>Finally, to add a risk table below the graph, plus the p-value
obtained from the log-rank test (which tests the difference between the
survival probabilities of 17/18 and 18/19 season), we do the
following.</p>
<details><summary>
Code for adding for info to the previous plot
</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ggsurv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survminer/man/ggsurvplot.html" class="external-link">ggsurvplot</a></span><span class="op">(</span><span class="va">fit</span>, data <span class="op">=</span> <span class="va">injd_sub</span>, </span>
<span>           palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#E7B800"</span>, <span class="st">"#2E9FDF"</span><span class="op">)</span>,</span>
<span>           risk.table <span class="op">=</span> <span class="cn">T</span>,</span>
<span>           conf.int <span class="op">=</span> <span class="cn">T</span>,  </span>
<span>           pval <span class="op">=</span> <span class="cn">T</span>,</span>
<span>           surv.median.line <span class="op">=</span> <span class="st">"hv"</span>,</span>
<span>           risk.table.col <span class="op">=</span> <span class="st">"strata"</span>, </span>
<span>           ggtheme <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>           break.time.by <span class="op">=</span> <span class="fl">60</span>,</span>
<span>           xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">370</span><span class="op">)</span>,</span>
<span>           legend.labs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Season 17/18"</span>, <span class="st">"Season 18/19"</span><span class="op">)</span>,</span>
<span>           legend.title <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Time (calendar days)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Survival probability  ("</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">hat</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span><span class="op">[</span><span class="va">KM</span><span class="op">]</span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">*</span><span class="st">")"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Kaplan-Meier curves"</span>, </span>
<span>          subtitle <span class="op">=</span> <span class="st">"in each season (time to first injury)"</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># add median survival estimates</span></span>
<span><span class="va">ggsurv</span><span class="op">$</span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="va">ggsurv</span><span class="op">$</span><span class="va">plot</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, </span>
<span>           x <span class="op">=</span> <span class="fl">70</span>, y <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>           label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">hat</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span><span class="op">[</span><span class="fl">18</span><span class="op">/</span><span class="fl">19</span><span class="op">]</span><span class="op">*</span><span class="st">"(106)=0.5"</span><span class="op">)</span>,</span>
<span>           col <span class="op">=</span> <span class="st">"#2E9FDF"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, </span>
<span>           x <span class="op">=</span> <span class="fl">230</span>, y <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>           label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">hat</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span><span class="op">[</span><span class="fl">17</span><span class="op">/</span><span class="fl">18</span><span class="op">]</span><span class="op">*</span><span class="st">"(265)=0.5"</span><span class="op">)</span>,</span>
<span>           col <span class="op">=</span> <span class="st">"#E7B800"</span><span class="op">)</span></span>
<span><span class="co"># quit title and y text of the risk table</span></span>
<span><span class="va">ggsurv</span><span class="op">$</span><span class="va">table</span> <span class="op">&lt;-</span> <span class="va">ggsurv</span><span class="op">$</span><span class="va">table</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Number of players at risk"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">rel</a></span><span class="op">(</span><span class="fl">1.5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">rel</a></span><span class="op">(</span><span class="fl">1.3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">rel</a></span><span class="op">(</span><span class="fl">1.3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ggsurv</span><span class="op">$</span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="va">ggsurv</span><span class="op">$</span><span class="va">plot</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">rel</a></span><span class="op">(</span><span class="fl">1.5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">rel</a></span><span class="op">(</span><span class="fl">1.5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">rel</a></span><span class="op">(</span><span class="fl">1.3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">rel</a></span><span class="op">(</span><span class="fl">1.3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">rel</a></span><span class="op">(</span><span class="fl">1.2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">ggsurv</span></span></code></pre></div>
</details><p><img src="model-injury-data-ii_files/figure-html/unnamed-chunk-13-1.png" width="960"></p>
<p>There are statistical differences regarding the survival
probabilities of first-time injuries between both seasons.</p>
</div>
<div class="section level3">
<h3 id="cox-ph-model">Cox PH model<a class="anchor" aria-label="anchor" href="#cox-ph-model"></a>
</h3>
<p>We can fit a Cox PH model which relates the covariates (<span class="math inline">\(\boldsymbol{x}\)</span>) to the injury outcome
through the hazard function as <span class="math inline">\(\lambda(t |
\boldsymbol{x}) =
\lambda_0(t)\exp(\boldsymbol{x}'\boldsymbol{\beta})\)</span>.</p>
<p>We use <code>injd1819_sub</code> data in this section and we add to
it another variable (i.e. <code>positionb</code>).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## create positionb column </span></span>
<span><span class="co">## (so that the categories are: Attack, Defender, Goalkeeper and Midfield)</span></span>
<span><span class="va">injd1819_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">injd1819_sub</span>,</span>
<span>                   positionb <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html" class="external-link">str_split_i</a></span><span class="op">(</span><span class="va">position</span>, <span class="st">"_"</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now, we fit a Cox PH model with three covariates: player position
(excluding goalkeepers), age and yellow cards received by each player
during the 18/19 season.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">tstop_day</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">positionb</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">yellows</span>,</span>
<span>              data <span class="op">=</span> <span class="va">injd1819_sub</span> <span class="op">|&gt;</span> </span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">positionb</span> <span class="op">!=</span> <span class="st">"Goalkeeper"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The estimated effects of the <code>cfit</code> model are:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cfit</span><span class="op">)</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; coxph(formula = Surv(tstop_day, status) ~ positionb + age + yellows, </span></span>
<span><span class="co">#&gt;     data = droplevels(filter(injd1819_sub, positionb != "Goalkeeper")))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   n= 18, number of events= 17 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                      coef exp(coef) se(coef)     z Pr(&gt;|z|)  </span></span>
<span><span class="co">#&gt; positionbDefender 0.58324   1.79183  0.80661 0.723   0.4696  </span></span>
<span><span class="co">#&gt; positionbMidfield 1.33266   3.79112  0.70604 1.888   0.0591 .</span></span>
<span><span class="co">#&gt; age               0.02391   1.02419  0.09937 0.241   0.8099  </span></span>
<span><span class="co">#&gt; yellows           0.03909   1.03986  0.20752 0.188   0.8506  </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                   exp(coef) exp(-coef) lower .95 upper .95</span></span>
<span><span class="co">#&gt; positionbDefender     1.792     0.5581    0.3687     8.707</span></span>
<span><span class="co">#&gt; positionbMidfield     3.791     0.2638    0.9501    15.127</span></span>
<span><span class="co">#&gt; age                   1.024     0.9764    0.8429     1.244</span></span>
<span><span class="co">#&gt; yellows               1.040     0.9617    0.6924     1.562</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Concordance= 0.629  (se = 0.072 )</span></span>
<span><span class="co">#&gt; Likelihood ratio test= 4.05  on 4 df,   p=0.4</span></span>
<span><span class="co">#&gt; Wald test            = 3.88  on 4 df,   p=0.4</span></span>
<span><span class="co">#&gt; Score (logrank) test = 4.27  on 4 df,   p=0.4</span></span></code></pre></div>
<p>The results are not very meaningful nor interesting, probably due to
the small sample size of the data.</p>
<p>The above summary can be displayed graphically (the hazard ratios and
95% confidence intervals, together with the p-values of each covariate,
and further information about the goodness of fit of the model) as:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/survminer/man/ggforest.html" class="external-link">ggforest</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">cfit</span>,</span>
<span>         data <span class="op">=</span> <span class="va">injd1819_sub</span> <span class="op">|&gt;</span> </span>
<span>           <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">positionb</span> <span class="op">!=</span> <span class="st">"Goalkeeper"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>         fontsize <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span></span></code></pre></div>
<p><img src="model-injury-data-ii_files/figure-html/unnamed-chunk-17-1.png" width="960"></p>
<p>Then, we can check if the proportional hazards assumption for the Cox
PH model is hold by computing the Schoenfeld residuals:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cox.zph.html" class="external-link">cox.zph</a></span><span class="op">(</span><span class="va">cfit</span><span class="op">)</span></span>
<span><span class="co">#&gt;           chisq df    p</span></span>
<span><span class="co">#&gt; positionb 1.465  2 0.48</span></span>
<span><span class="co">#&gt; age       2.578  1 0.11</span></span>
<span><span class="co">#&gt; yellows   0.315  1 0.57</span></span>
<span><span class="co">#&gt; GLOBAL    5.961  4 0.20</span></span></code></pre></div>
<p>The PH assumption is violated as seen in the above output (GLOBAL
p-value).</p>
<p>Let’s check the residuals for each covariate in the model
graphically:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/survminer/man/ggcoxzph.html" class="external-link">ggcoxzph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cox.zph.html" class="external-link">cox.zph</a></span><span class="op">(</span><span class="va">cfit</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="model-injury-data-ii_files/figure-html/unnamed-chunk-19-1.png" width="960"></p>
</div>
</div>
<div class="section level2">
<h2 id="models-for-time-to-subsequent-injuries">Models for time to (subsequent) injuries<a class="anchor" aria-label="anchor" href="#models-for-time-to-subsequent-injuries"></a>
</h2>
<p>The following models are useful to account for heterogeneity among
different observations or group of subjects.</p>
<div class="section level3">
<h3 id="stratified-cox-ph-model">Stratified Cox PH model<a class="anchor" aria-label="anchor" href="#stratified-cox-ph-model"></a>
</h3>
<p>To fit a stratified Cox PH model, we use the (previously prepared)
<code>injd_sub</code> data, where the <code>seasonb</code> column has
two levels. With this model we fit a different baseline hazard function
for each level (stratum) of the <code>seasonb</code> covariate (strata),
i.e. <span class="math inline">\(\lambda(t | \boldsymbol{x}) =
\lambda_{0,k}(t)\exp(\boldsymbol{x}'\boldsymbol{\beta})\)</span> for
<span class="math inline">\(k = 1, 2\)</span>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">tstart_day</span>, <span class="va">tstop_day</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">seasonb</span><span class="op">)</span>, </span>
<span>              data <span class="op">=</span> <span class="va">injd_sub</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sfit</span><span class="op">)</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; coxph(formula = Surv(tstart_day, tstop_day, status) ~ age + strata(seasonb), </span></span>
<span><span class="co">#&gt;     data = injd_sub)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   n= 42, number of events= 33 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;        coef exp(coef) se(coef)     z Pr(&gt;|z|)</span></span>
<span><span class="co">#&gt; age 0.01749   1.01764  0.05541 0.316    0.752</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     exp(coef) exp(-coef) lower .95 upper .95</span></span>
<span><span class="co">#&gt; age     1.018     0.9827    0.9129     1.134</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Concordance= 0.6  (se = 0.069 )</span></span>
<span><span class="co">#&gt; Likelihood ratio test= 0.1  on 1 df,   p=0.8</span></span>
<span><span class="co">#&gt; Wald test            = 0.1  on 1 df,   p=0.8</span></span>
<span><span class="co">#&gt; Score (logrank) test = 0.1  on 1 df,   p=0.8</span></span></code></pre></div>
<p>The effect of age, <span class="math inline">\(\widehat{\text{HR}}_{\text{age}} =
\exp(\hat{\beta}_{\text{age}}) = 1.02\)</span>, is not significant.
However, we will keep on and illustrate how to plot the estimates of two
players of different ages, 18 year-old vs. 36 year-old in both seasons,
based on the fitted stratified model.</p>
<p>First, we put the wanted estimates in a data frame.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## surv estimates of a player of 18 year-old based on sfit</span></span>
<span><span class="va">player1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fl">18</span><span class="op">)</span></span>
<span><span class="va">sfitn1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html" class="external-link">survfit</a></span><span class="op">(</span><span class="va">sfit</span>, newdata <span class="op">=</span> <span class="va">player1</span><span class="op">)</span></span>
<span><span class="va">sfitn1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>surv <span class="op">=</span> <span class="va">sfitn1</span><span class="op">$</span><span class="va">surv</span>, </span>
<span>                     time <span class="op">=</span> <span class="va">sfitn1</span><span class="op">$</span><span class="va">time</span>,</span>
<span>                     strata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sfitn1</span><span class="op">$</span><span class="va">strata</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">sfitn1</span><span class="op">$</span><span class="va">strata</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                                <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sfitn1</span><span class="op">$</span><span class="va">strata</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, <span class="va">sfitn1</span><span class="op">$</span><span class="va">strata</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     age <span class="op">=</span> <span class="fl">18</span><span class="op">)</span> </span>
<span><span class="co">## surv estimates of a player of 36 year-old based on sfit</span></span>
<span><span class="va">player2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fl">36</span><span class="op">)</span> </span>
<span><span class="va">sfitn2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html" class="external-link">survfit</a></span><span class="op">(</span><span class="va">sfit</span>, newdata <span class="op">=</span> <span class="va">player2</span><span class="op">)</span></span>
<span><span class="va">sfitn2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>surv <span class="op">=</span> <span class="va">sfitn2</span><span class="op">$</span><span class="va">surv</span>, </span>
<span>                     time <span class="op">=</span> <span class="va">sfitn2</span><span class="op">$</span><span class="va">time</span>,</span>
<span>                     strata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sfitn2</span><span class="op">$</span><span class="va">strata</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">sfitn2</span><span class="op">$</span><span class="va">strata</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                                <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sfitn2</span><span class="op">$</span><span class="va">strata</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, <span class="va">sfitn2</span><span class="op">$</span><span class="va">strata</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     age <span class="op">=</span> <span class="fl">36</span><span class="op">)</span> </span>
<span></span>
<span><span class="co">## bind both data frames</span></span>
<span><span class="va">sfitn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">sfitn1</span>, <span class="va">sfitn2</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>strata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">strata</span><span class="op">)</span>,</span>
<span>         Age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Then, we plot them:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sfitn</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">surv</span>, col <span class="op">=</span> <span class="va">strata</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="va">Age</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Season"</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#E7B800"</span>, <span class="st">"#2E9FDF"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"t [calendar days]"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">hat</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">rel</a></span><span class="op">(</span><span class="fl">1.3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">rel</a></span><span class="op">(</span><span class="fl">1.3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">rel</a></span><span class="op">(</span><span class="fl">1.4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">rel</a></span><span class="op">(</span><span class="fl">1.4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="model-injury-data-ii_files/figure-html/unnamed-chunk-23-1.png" width="960"></p>
<p>But the proportional hazard assumption for each strata doesn’t
hold:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cox.zph.html" class="external-link">cox.zph</a></span><span class="op">(</span><span class="va">sfit</span><span class="op">)</span></span>
<span><span class="co">#&gt;        chisq df     p</span></span>
<span><span class="co">#&gt; age        6  1 0.014</span></span>
<span><span class="co">#&gt; GLOBAL     6  1 0.014</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="shared-frailty-model">Shared frailty model<a class="anchor" aria-label="anchor" href="#shared-frailty-model"></a>
</h3>
<p>Shared frailty models allow to model the dependence between several
survival times through a frailty term that is shared by all the survival
times pertaining to a player or, in general, to a cluster. This way,
survival times of a player that sustains multiple injuries have the same
level of frailty attached to them. It is expressed as <span class="math inline">\(\lambda(t | \boldsymbol{x}, \alpha) =
\lambda_{0}(t)\exp(\boldsymbol{x}'\boldsymbol{\beta})\alpha_l =
\lambda_{0}(t)\exp(\boldsymbol{x}'\boldsymbol{\beta} + b_l)\)</span>
for <span class="math inline">\(l = 1, \ldots, L\)</span> players, where
<span class="math inline">\(\alpha = \exp(b)\)</span> usually follows a
Gamma or log-normal distribution.</p>
<details><summary>
Code to prepare the data
</summary><div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## prepare exposure data set and create seasonb column</span></span>
<span><span class="va">df_exposures</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_data.html">prepare_exp</a></span><span class="op">(</span>df_exposures0 <span class="op">=</span> <span class="va">raw_df_exposures</span>,</span>
<span>                             player        <span class="op">=</span> <span class="st">"player_name"</span>,</span>
<span>                             date          <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>                             time_expo     <span class="op">=</span> <span class="st">"minutes_played"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>seasonb <span class="op">=</span> <span class="fu"><a href="../reference/date2season.html">date2season</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## add more info to injd data frame (based on exposure data)</span></span>
<span><span class="va">injd</span> <span class="op">&lt;-</span> <span class="va">injd</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>seasonb <span class="op">=</span> <span class="fu"><a href="../reference/date2season.html">date2season</a></span><span class="op">(</span><span class="va">tstart</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">df_exposures</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"player"</span> <span class="op">=</span> <span class="st">"player"</span>,</span>
<span>                                  <span class="st">"seasonb"</span> <span class="op">=</span> <span class="st">"seasonb"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>positionb <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html" class="external-link">str_split_i</a></span><span class="op">(</span><span class="va">position</span>, <span class="st">"_"</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         injury_severity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">addNA</a></span><span class="op">(</span><span class="va">injury_severity</span><span class="op">)</span>,</span>
<span>         days_lost <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">days_lost</span>, default <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>         games_lost <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">games_lost</span>, default <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>         prev_inj <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">enum</span>, default <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</details><p>Code to do some more data set-up:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">injd</span> <span class="op">&lt;-</span> <span class="va">injd</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>tstop_minPlay <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">tstop_minPlay</span> <span class="op">==</span> <span class="va">tstart_minPlay</span>,</span>
<span>                                <span class="va">tstop_minPlay</span> <span class="op">+</span> <span class="fl">1</span>, <span class="va">tstop_minPlay</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">positionb</span> <span class="op">!=</span> <span class="st">"Goalkeeper"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Now, we fit a shared frailty model in which the frailty term follows
a Gamma distribution using the <code>frailty(player)</code> syntax
inside <code><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">survival::coxph</a></code> function’s formula:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sffit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">tstart_minPlay</span>, <span class="va">tstop_minPlay</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> </span>
<span>                 <span class="va">age</span> <span class="op">+</span> <span class="va">days_lost</span> <span class="op">+</span> </span>
<span>                 <span class="fu"><a href="https://rdrr.io/pkg/survival/man/frailty.html" class="external-link">frailty</a></span><span class="op">(</span><span class="va">player</span>, distribution <span class="op">=</span> <span class="st">"gamma"</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">injd</span><span class="op">)</span></span></code></pre></div>
<p>Or alternatively, we can use the <code>coxme</code> package (there
are more packages also) and fit a model with a log-normal frailty using
the <code>(1 | player)</code> syntax:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sffit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coxme/man/coxme.html" class="external-link">coxme</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">tstart_minPlay</span>, <span class="va">tstop_minPlay</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> </span>
<span>                  <span class="va">age</span> <span class="op">+</span> <span class="va">days_lost</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">player</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">injd</span><span class="op">)</span></span></code></pre></div>
<p>This model is also called a random intercepts model, since the
frailty term acts in a multiplicative way on the hazard (or the
“intercept” of the curve).</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sffit</span><span class="op">)</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; coxph(formula = Surv(tstart_minPlay, tstop_minPlay, status) ~ </span></span>
<span><span class="co">#&gt;     age + days_lost + frailty(player, distribution = "gamma"), </span></span>
<span><span class="co">#&gt;     data = injd)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   n= 104, number of events= 81 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                           coef      se(coef) se2      Chisq  DF    p      </span></span>
<span><span class="co">#&gt; age                        0.489503 0.278965            3.08  1.00 7.9e-02</span></span>
<span><span class="co">#&gt; days_lost                 -0.006381 0.009761 0.006744   0.43  1.00 5.1e-01</span></span>
<span><span class="co">#&gt; frailty(player, distribut                             230.57 15.72 3.3e-40</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;           exp(coef) exp(-coef) lower .95 upper .95</span></span>
<span><span class="co">#&gt; age          1.6315     0.6129    0.9443     2.819</span></span>
<span><span class="co">#&gt; days_lost    0.9936     1.0064    0.9748     1.013</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Iterations: 10 outer, 184 Newton-Raphson</span></span>
<span><span class="co">#&gt;      Variance of random effect= 2.673384   I-likelihood = -171.4 </span></span>
<span><span class="co">#&gt; Degrees of freedom for terms= -2.3  0.5 15.7 </span></span>
<span><span class="co">#&gt; Concordance= 0.882  (se = 0.026 )</span></span>
<span><span class="co">#&gt; Likelihood ratio test= 122.5  on 13.88 df,   p=&lt;2e-16</span></span></code></pre></div>
<p>The estimated variance of the random effect is $^2 = $ 2.691371 and
the p-value of the frailty term is significant.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sffit2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Cox mixed-effects model fit by maximum likelihood</span></span>
<span><span class="co">#&gt;   Data: injd</span></span>
<span><span class="co">#&gt;   events, n = 81, 104</span></span>
<span><span class="co">#&gt;   Iterations= 21 111 </span></span>
<span><span class="co">#&gt;                     NULL Integrated   Fitted</span></span>
<span><span class="co">#&gt; Log-likelihood -190.7449  -164.8804 -122.959</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                    Chisq    df          p   AIC   BIC</span></span>
<span><span class="co">#&gt; Integrated loglik  51.73  3.00 3.4212e-11 45.73 38.55</span></span>
<span><span class="co">#&gt;  Penalized loglik 135.57 21.69 0.0000e+00 92.20 40.27</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model:  Surv(tstart_minPlay, tstop_minPlay, status) ~ age + days_lost +      (1 | player) </span></span>
<span><span class="co">#&gt; Fixed coefficients</span></span>
<span><span class="co">#&gt;                  coef exp(coef)   se(coef)     z     p</span></span>
<span><span class="co">#&gt; age        0.52986625 1.6987051 0.22283770  2.38 0.017</span></span>
<span><span class="co">#&gt; days_lost -0.01228762 0.9877876 0.01001641 -1.23 0.220</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random effects</span></span>
<span><span class="co">#&gt;  Group  Variable  Std Dev   Variance </span></span>
<span><span class="co">#&gt;  player Intercept  3.472957 12.061429</span></span></code></pre></div>
<p>Let’s plot the covariate effects, i.e hazard ratios, and the frailty
terms of the <code>sffit</code> model:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## plot p1, for covariate effects</span></span>
<span><span class="co">## a trick to not to plot frailties as HRs</span></span>
<span><span class="va">sffit_aux</span> <span class="op">&lt;-</span> <span class="va">sffit</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">sffit_aux</span><span class="op">$</span><span class="va">terms</span>, <span class="st">"dataClasses"</span><span class="op">)</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">sffit_aux</span><span class="op">$</span><span class="va">terms</span>, <span class="st">"dataClasses"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span> </span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survminer/man/ggforest.html" class="external-link">ggforest</a></span><span class="op">(</span><span class="va">sffit_aux</span>, data <span class="op">=</span> <span class="va">injd</span>,</span>
<span>               fontsize <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## plot p2, for frailty terms</span></span>
<span><span class="va">df_frailties</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>player <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">injd</span><span class="op">$</span><span class="va">player</span><span class="op">)</span>, </span>
<span>                           frail <span class="op">=</span> <span class="va">sffit</span><span class="op">$</span><span class="va">frail</span>,</span>
<span>                           expfrail <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">sffit</span><span class="op">$</span><span class="va">frail</span><span class="op">)</span>,</span>
<span>                           col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">sffit</span><span class="op">$</span><span class="va">frail</span> <span class="op">&gt;=</span> <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df_frailties</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">player</span>, xend <span class="op">=</span> <span class="va">player</span>, </span>
<span>                   y <span class="op">=</span> <span class="fl">1</span>, yend <span class="op">=</span> <span class="va">expfrail</span>, col <span class="op">=</span> <span class="va">col</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">player</span>, y <span class="op">=</span> <span class="va">expfrail</span> <span class="op">+</span> <span class="fl">0.12</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/sign.html" class="external-link">sign</a></span><span class="op">(</span><span class="va">frail</span><span class="op">)</span>, label <span class="op">=</span> <span class="va">player</span><span class="op">)</span>,</span>
<span>            size <span class="op">=</span> <span class="fl">3</span>, angle <span class="op">=</span> <span class="fl">30</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">""</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"darkred"</span>, <span class="st">"dodgerblue"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<details><summary>
Code for further plot specifications
</summary><div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_frailties</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>player <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">injd</span><span class="op">$</span><span class="va">player</span><span class="op">)</span>, </span>
<span>                           frail <span class="op">=</span> <span class="va">sffit</span><span class="op">$</span><span class="va">frail</span>,</span>
<span>                           expfrail <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">sffit</span><span class="op">$</span><span class="va">frail</span><span class="op">)</span>,</span>
<span>                           col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">sffit</span><span class="op">$</span><span class="va">frail</span> <span class="op">&gt;=</span> <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df_frailties</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">player</span>, xend <span class="op">=</span> <span class="va">player</span>,</span>
<span>                   y <span class="op">=</span> <span class="fl">1</span>, yend <span class="op">=</span> <span class="va">expfrail</span>, col <span class="op">=</span> <span class="va">col</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">player</span>, y <span class="op">=</span> <span class="va">expfrail</span> <span class="op">+</span> <span class="fl">0.12</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/sign.html" class="external-link">sign</a></span><span class="op">(</span><span class="va">frail</span><span class="op">)</span>, label <span class="op">=</span> <span class="va">player</span><span class="op">)</span>,</span>
<span>            size <span class="op">=</span> <span class="fl">3</span>, angle <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">""</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"darkred"</span>, <span class="st">"dodgerblue"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_x_discrete</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.08</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">exp</span><span class="op">*</span><span class="st">"(frail)"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Player"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Frailties"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>        axis.ticks.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">rel</a></span><span class="op">(</span><span class="fl">1.2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">rel</a></span><span class="op">(</span><span class="fl">1.2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">rel</a></span><span class="op">(</span><span class="fl">1.4</span><span class="op">)</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</details><div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, nrow <span class="op">=</span> <span class="fl">2</span>, heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1.3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="model-injury-data-ii_files/figure-html/unnamed-chunk-34-1.png" width="700"></p>
<p>The models in this section might be extended to model data that
present different cluster structures or hierarchical levels,
e.g. players in the same team, club, league etc.</p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://lzumeta.eus/" class="external-link">Lore Zumeta Olaskoaga</a>, <a href="http://idaejin.github.io/" class="external-link">Dae-Jin Lee</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
